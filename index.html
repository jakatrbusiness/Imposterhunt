<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Imposter - Vem √§r bedragaren?</title>
    <style>
        /* --- CSS VARIABLER & GRUNDDESIGN --- */
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #bb86fc;
            --secondary-color: #03dac6;
            --error-color: #cf6679;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --btn-text: #000000;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 16px;
        }

        #app {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* --- UTILITY CLASSES --- */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .bold { font-weight: bold; }
        .text-secondary { color: var(--text-secondary); }
        .text-error { color: var(--error-color); }
        .text-accent { color: var(--secondary-color); }

        /* --- CONTAINERS & CARDS --- */
        .card {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .role-card {
            border: 2px dashed var(--primary-color);
            padding: 30px 20px;
            margin: 20px 0;
            text-align: center;
        }

        /* --- TYPOGRAFI --- */
        h1 { color: var(--primary-color); margin-bottom: 0.5rem; text-align: center; letter-spacing: 1px;}
        h2 { margin-bottom: 1rem; font-size: 1.5rem; }
        h3 { margin-bottom: 0.5rem; font-size: 1.2rem; color: var(--secondary-color); }
        p { line-height: 1.5; margin-bottom: 0.8rem; }
        
        .big-word {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin: 10px 0;
            text-transform: uppercase;
            word-break: break-word;
        }

        .imposter-title {
            font-size: 2rem;
            color: var(--error-color);
            font-weight: bold;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }
        
        .win-message {
            font-size: 2rem;
            color: var(--error-color);
            font-weight: 900;
            text-transform: uppercase;
            margin: 20px 0;
            padding: 10px;
            border: 2px solid var(--error-color);
            border-radius: 8px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* --- INPUTS & KNAPPAR --- */
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0 20px 0;
            cursor: pointer;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-color);
        }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-bottom: 10px;
            color: var(--btn-text); /* Standardknappar har svart text */
        }

        button:active { opacity: 0.8; transform: scale(0.98); }

        .btn-primary { background-color: var(--primary-color); color: var(--btn-text); }
        .btn-secondary { background-color: #333; color: var(--text-primary); border: 1px solid #555; }
        .btn-danger { background-color: var(--error-color); color: white; }
        
        /* Fix f√∂r r√∂stknappar: Vit text */
        .btn-vote { 
            background-color: #2c2c2c; 
            color: white !important; /* Tvinga vit f√§rg */
            border: 1px solid var(--primary-color); 
            margin-bottom: 8px; 
            text-align: left; 
        }
        
        .input-group { display: flex; gap: 10px; }
        .input-group button { width: auto; white-space: nowrap; }

        /* --- LISTOR --- */
        ul { list-style: none; padding: 0; }
        li {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        li.eliminated { opacity: 0.5; text-decoration: line-through; background: #2a1a1a; }

        .delete-btn {
            background: none; color: var(--error-color); border: none; 
            font-size: 1.2rem; padding: 0 10px; width: auto; margin: 0;
        }

        /* --- CONFETTI CANVAS --- */
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999;
        }

        /* --- REGLER BOX --- */
        .rules-box {
            background-color: rgba(187, 134, 252, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            font-size: 0.9rem;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div id="app">
    
    <!-- VY 1: SETUP / START -->
    <div id="view-setup">
        <h1>üïµÔ∏è Imposter</h1>
        
        <div class="rules-box">
            <h3>S√• h√§r spelar du</h3>
            <p>1. Alla f√•r ett hemligt ord f√∂rutom <strong>Imposters</strong> (bedragarna).</p>
            <p>2. Ge ledtr√•dar laget runt. Avsl√∂ja inte ordet!</p>
            <p>3. Imposters m√•ste bluffa och l√•tsas veta ordet.</p>
            <p>4. R√∂sta ut den misst√§nkta. Om bedragarna √∂verlever vinner de!</p>
        </div>

        <div class="card">
            <h3>L√§gg till spelare</h3>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="Namn..." onkeypress="handleEnter(event)">
                <button class="btn-secondary" onclick="addPlayer()">L√§gg till</button>
            </div>
            <ul id="player-list"></ul>
            <div id="setup-error" class="text-error text-center mb-4"></div>
        </div>

        <div class="card">
            <h3>Inst√§llningar</h3>
            <label>Antal Imposters:</label>
            <input type="number" id="imposter-count" value="1" min="1">
            
            <label class="checkbox-wrapper">
                <input type="checkbox" id="use-theme-toggle">
                <span>Visa tema/kategori p√• ordet</span>
            </label>
        </div>

        <button class="btn-primary" onclick="startGame()">Starta Spel</button>
    </div>

    <!-- VY 2: SKICKA ENHETEN (ROLL) -->
    <div id="view-pass" class="hidden text-center">
        <h2>L√§mna enheten</h2>
        <p class="text-secondary">Ge enheten till:</p>
        <h1 id="pass-player-name" class="text-accent">NAMN</h1>
        <p class="mt-4 mb-4">Se till att ingen annan ser sk√§rmen!</p>
        <button class="btn-primary" onclick="revealRole()">Visa min roll</button>
    </div>

    <!-- VY 3: VISA ROLL -->
    <div id="view-reveal" class="hidden">
        <h2 class="text-center">Din roll</h2>
        
        <div class="role-card" id="role-card-content">
            <!-- Inneh√•ll genereras med JS -->
        </div>

        <p class="text-center text-secondary mb-4">Memorera detta. Tryck sen p√• knappen.</p>
        <button class="btn-secondary" onclick="nextRole()">Klar / G√∂m</button>
    </div>

    <!-- VY 4: SPELRUNDA -->
    <div id="view-game" class="hidden">
        <h1>Spelet p√•g√•r</h1>
        
        <div class="rules-box">
            <p><strong>Regler:</strong></p>
            <p>‚Ä¢ Yngsta spelaren b√∂rjar ge en ledtr√•d.</p>
            <p>‚Ä¢ G√• laget runt med ledtr√•dar.</p>
            <p>‚Ä¢ S√§g <strong>inte</strong> ordet rakt ut!</p>
            <p>‚Ä¢ Bedragarna f√∂rs√∂ker sm√§lta in.</p>
        </div>

        <div class="card">
            <h3>Spelare i spelet</h3>
            <ul id="game-player-list"></ul>
        </div>

        <button class="btn-primary mt-4" onclick="initVoting()">Starta R√∂stning</button>
    </div>

    <!-- VY 5: R√ñSTNING - SKICKA -->
    <div id="view-vote-pass" class="hidden text-center">
        <h2>Dags att r√∂sta</h2>
        <p>L√§mna enheten till:</p>
        <h1 id="vote-pass-name" class="text-accent">NAMN</h1>
        <button class="btn-primary mt-4" onclick="showVoteInput()">Jag √§r redo att r√∂sta</button>
    </div>

    <!-- VY 6: R√ñSTNING - VAL -->
    <div id="view-vote-input" class="hidden">
        <h2 class="text-center">Vem vill du r√∂sta ut?</h2>
        <p class="text-center text-secondary mb-4">V√§lj den du tror √§r Imposter.</p>
        <div id="vote-buttons-container"></div>
    </div>

    <!-- VY 7: R√ñSTNING - PRE-RESULT (NEW) -->
    <div id="view-vote-pre-result" class="hidden text-center">
        <h2>Alla har r√∂stat</h2>
        <p class="text-secondary mb-4">√Ñr ni redo f√∂r resultatet?</p>
        
        <div id="vote-reveal-wrapper">
            <button class="btn-primary" id="btn-show-vote-res" onclick="startVoteCountdown()">VISA R√ñSTNINGSRESULTAT</button>
        </div>

        <div id="vote-timer-container" class="hidden">
            <h1 id="vote-timer" style="font-size: 5rem; color: var(--secondary-color);">5</h1>
            <p>R√§knar r√∂sterna...</p>
        </div>
    </div>

    <!-- VY 8: R√ñSTNING - RESULTAT -->
    <div id="view-vote-result" class="hidden text-center">
        <h2>R√∂stningen √§r klar</h2>
        <div class="card">
            <p id="vote-result-text" style="font-size: 1.2rem;"></p>
        </div>
        
        <div id="vote-actions">
            <button class="btn-primary" onclick="continueGame()">Forts√§tt spela</button>
            <button class="btn-secondary" onclick="endGameSequence()">Avsluta och se facit</button>
        </div>
    </div>

    <!-- VY 9: FACIT / AVSLUT -->
    <div id="view-end" class="hidden text-center">
        <div id="countdown-container">
            <h1>Spelet avslutas om...</h1>
            <h1 id="countdown-timer" style="font-size: 4rem;">3</h1>
        </div>

        <div id="final-reveal" class="hidden">
            <h1>FACIT</h1>
            
            <div id="imposter-win-wrapper" class="hidden">
                <div class="win-message">IMPOSTERS VANN SPELET!</div>
            </div>

            <div class="card">
                <p class="text-secondary">Det hemliga ordet var:</p>
                <div id="final-word" class="big-word">ORD</div>
                <p id="final-theme" class="text-accent bold"></p>
            </div>

            <div class="card" style="border: 1px solid var(--error-color);">
                <h3>Imposters var:</h3>
                <div id="final-imposters-list" style="font-size: 1.5rem; font-weight: bold;"></div>
            </div>

            <div class="card">
                <h3>Vanliga spelare:</h3>
                <div id="final-innocents-list" class="text-secondary"></div>
            </div>

            <button class="btn-primary mt-4" onclick="resetToSetup()">Ny Omg√•ng</button>
        </div>
    </div>

</div>

<script>
    // --- DATA: ORDLISTA ---
    const wordData = [
        // üçï Mat & Dryck
        { word: "Pannkaka", theme: "Mat & Dryck üçï" }, { word: "Spagetti", theme: "Mat & Dryck üçï" },
        { word: "Glass", theme: "Mat & Dryck üçï" }, { word: "Sm√∂rg√•s", theme: "Mat & Dryck üçï" },
        { word: "Korv", theme: "Mat & Dryck üçï" }, { word: "Potatis", theme: "Mat & Dryck üçï" },
        { word: "√Ñgg", theme: "Mat & Dryck üçï" }, { word: "Soppa", theme: "Mat & Dryck üçï" },
        { word: "Ris", theme: "Mat & Dryck üçï" }, { word: "Kyckling", theme: "Mat & Dryck üçï" },
        { word: "Banan", theme: "Mat & Dryck üçï" }, { word: "√Ñpple", theme: "Mat & Dryck üçï" },
        { word: "Vindruvor", theme: "Mat & Dryck üçï" }, { word: "Vattenmelon", theme: "Mat & Dryck üçï" },
        { word: "Chips", theme: "Mat & Dryck üçï" }, { word: "Kex", theme: "Mat & Dryck üçï" },
        { word: "Mellanm√•l", theme: "Mat & Dryck üçï" }, { word: "Energidryck", theme: "Mat & Dryck üçï" },
        { word: "Yoghurt", theme: "Mat & Dryck üçï" }, { word: "Ost", theme: "Mat & Dryck üçï" },

        // üìç Platser
        { word: "Torg", theme: "Platser üìç" }, { word: "Tunnelbana", theme: "Platser üìç" },
        { word: "Skog", theme: "Platser üìç" }, { word: "Berg", theme: "Platser üìç" },
        { word: "Bro", theme: "Platser üìç" }, { word: "Hotell", theme: "Platser üìç" },
        { word: "Museum", theme: "Platser üìç" }, { word: "Kaf√©", theme: "Platser üìç" },
        { word: "Hav", theme: "Platser üìç" }, { word: "Parkering", theme: "Platser üìç" },
        { word: "Klassrum", theme: "Platser üìç" }, { word: "Vardagsrum", theme: "Platser üìç" },
        { word: "Balkong", theme: "Platser üìç" }, { word: "K√§llare", theme: "Platser üìç" },
        { word: "Tak", theme: "Platser üìç" }, { word: "Kontor", theme: "Platser üìç" },
        { word: "Stormarknad", theme: "Platser üìç" }, { word: "Bussh√•llplats", theme: "Platser üìç" },
        { word: "Kyrka", theme: "Platser üìç" }, { word: "Strandpromenad", theme: "Platser üìç" },

        // üíª Teknik
        { word: "Router", theme: "Teknik üíª" }, { word: "Surfplatta", theme: "Teknik üíª" },
        { word: "H√∂gtalare", theme: "Teknik üíª" }, { word: "Smartklocka", theme: "Teknik üíª" },
        { word: "Mikrofon", theme: "Teknik üíª" }, { word: "Str√∂mkabel", theme: "Teknik üíª" },
        { word: "Fj√§rrkontroll", theme: "Teknik üíª" }, { word: "USB-minne", theme: "Teknik üíª" },
        { word: "Tangentbord", theme: "Teknik üíª" }, { word: "Mus", theme: "Teknik üíª" },
        { word: "Projektor", theme: "Teknik üíª" }, { word: "Powerbank", theme: "Teknik üíª" },
        { word: "Bluetooth-h√∂gtalare", theme: "Teknik üíª" }, { word: "Headset", theme: "Teknik üíª" },
        { word: "Sk√§rm", theme: "Teknik üíª" }, { word: "Webbkamera", theme: "Teknik üíª" },
        { word: "Batteri", theme: "Teknik üíª" }, { word: "Laddare", theme: "Teknik üíª" },
        { word: "Kablar", theme: "Teknik üíª" }, { word: "Processor", theme: "Teknik üíª" },

        // üèÖ Sport
        { word: "Basket", theme: "Sport üèÖ" }, { word: "Volleyboll", theme: "Sport üèÖ" },
        { word: "Boxning", theme: "Sport üèÖ" }, { word: "MMA", theme: "Sport üèÖ" },
        { word: "Pingis", theme: "Sport üèÖ" }, { word: "Bowling", theme: "Sport üèÖ" },
        { word: "Handboll", theme: "Sport üèÖ" }, { word: "Friidrott", theme: "Sport üèÖ" },
        { word: "Skor", theme: "Sport üèÖ" }, { word: "Racket", theme: "Sport üèÖ" },
        { word: "M√•lbur", theme: "Sport üèÖ" }, { word: "Domare", theme: "Sport üèÖ" },
        { word: "Medalj", theme: "Sport üèÖ" }, { word: "Gymnastik", theme: "Sport üèÖ" },
        { word: "B√§nkpress", theme: "Sport üèÖ" }, { word: "Hoppborg", theme: "Sport üèÖ" },
        { word: "Rullskridskor", theme: "Sport üèÖ" }, { word: "Snowboard", theme: "Sport üèÖ" },
        { word: "Spurt", theme: "Sport üèÖ" }, { word: "M√•lvakt", theme: "Sport üèÖ" },

        // üêæ Djur
        { word: "Ko", theme: "Djur üêæ" }, { word: "Gris", theme: "Djur üêæ" },
        { word: "Get", theme: "Djur üêæ" }, { word: "R√§v", theme: "Djur üêæ" },
        { word: "Panda", theme: "Djur üêæ" }, { word: "Zebra", theme: "Djur üêæ" },
        { word: "Tiger", theme: "Djur üêæ" }, { word: "Pingvin", theme: "Djur üêæ" },
        { word: "Bj√∂rn", theme: "Djur üêæ" }, { word: "Haj", theme: "Djur üêæ" },
        { word: "Delfin", theme: "Djur üêæ" }, { word: "Groda", theme: "Djur üêæ" },
        { word: "Sk√∂ldpadda", theme: "Djur üêæ" }, { word: "Uggla", theme: "Djur üêæ" },
        { word: "R√•tta", theme: "Djur üêæ" }, { word: "Hamster", theme: "Djur üêæ" },
        { word: "Apa", theme: "Djur üêæ" }, { word: "Val", theme: "Djur üêæ" },
        { word: "√ñrn", theme: "Djur üêæ" },

        // üöó Fordon
        { word: "Motorcykel", theme: "Fordon üöó" }, { word: "Elbil", theme: "Fordon üöó" },
        { word: "Lastbil", theme: "Fordon üöó" }, { word: "Ambulans", theme: "Fordon üöó" },
        { word: "Polisbil", theme: "Fordon üöó" }, { word: "Traktor", theme: "Fordon üöó" },
        { word: "Moped", theme: "Fordon üöó" }, { word: "Skoter", theme: "Fordon üöó" },
        { word: "Segway", theme: "Fordon üöó" }, { word: "Sparkcykel", theme: "Fordon üöó" },
        { word: "F√§rja", theme: "Fordon üöó" }, { word: "Helikopter", theme: "Fordon üöó" },
        { word: "Jetski", theme: "Fordon üöó" }, { word: "T√•g", theme: "Fordon üöó" },
        { word: "Kabelbil", theme: "Fordon üöó" }, { word: "Buss", theme: "Fordon üöó" },
        { word: "Husbil", theme: "Fordon üöó" }, { word: "Pickup", theme: "Fordon üöó" },
        { word: "Taxi", theme: "Fordon üöó" }, { word: "BMX-cykel", theme: "Fordon üöó" },

        // üéµ Musik
        { word: "H√∂gtalare", theme: "Musik üéµ" }, { word: "Trumpet", theme: "Musik üéµ" },
        { word: "Violin", theme: "Musik üéµ" }, { word: "Bas", theme: "Musik üéµ" },
        { word: "Mixbord", theme: "Musik üéµ" }, { word: "DJ-skiva", theme: "Musik üéµ" },
        { word: "K√∂r", theme: "Musik üéµ" }, { word: "Notpapper", theme: "Musik üéµ" },
        { word: "Trombon", theme: "Musik üéµ" }, { word: "Saxofon", theme: "Musik üéµ" },
        { word: "Slagverk", theme: "Musik üéµ" }, { word: "Elgitarr", theme: "Musik üéµ" },
        { word: "Synth", theme: "Musik üéµ" }, { word: "Metronom", theme: "Musik üéµ" },
        { word: "Trumma", theme: "Musik üéµ" }, { word: "L√•t", theme: "Musik üéµ" },
        { word: "Rytm", theme: "Musik üéµ" }, { word: "Mikrofonstativ", theme: "Musik üéµ" },
        { word: "Band", theme: "Musik üéµ" }, { word: "Pianostol", theme: "Musik üéµ" },

        // üëï Kl√§der
        { word: "Hoodie", theme: "Kl√§der üëï" }, { word: "T-shirt", theme: "Kl√§der üëï" },
        { word: "Kostym", theme: "Kl√§der üëï" }, { word: "Shorts", theme: "Kl√§der üëï" },
        { word: "Sneakers", theme: "Kl√§der üëï" }, { word: "Mjukisbyxor", theme: "Kl√§der üëï" },
        { word: "M√∂ssa", theme: "Kl√§der üëï" }, { word: "Handskar", theme: "Kl√§der üëï" },
        { word: "Sandaler", theme: "Kl√§der üëï" }, { word: "Badbyxor", theme: "Kl√§der üëï" },
        { word: "Kappa", theme: "Kl√§der üëï" }, { word: "Skjorta", theme: "Kl√§der üëï" },
        { word: "B√§lte", theme: "Kl√§der üëï" }, { word: "Klocka", theme: "Kl√§der üëï" },
        { word: "Paraply", theme: "Kl√§der üëï" }, { word: "V√§st", theme: "Kl√§der üëï" },
        { word: "Halsduk", theme: "Kl√§der üëï" }, { word: "Hatt", theme: "Kl√§der üëï" },
        { word: "Ryggs√§ck", theme: "Kl√§der üëï" }, { word: "Flipflops", theme: "Kl√§der üëï" },

        // üè† Hemmet
        { word: "S√§ng", theme: "Hemmet üè†" }, { word: "Kudde", theme: "Hemmet üè†" },
        { word: "Dusch", theme: "Hemmet üè†" }, { word: "Diskmaskin", theme: "Hemmet üè†" },
        { word: "Dammsugare", theme: "Hemmet üè†" }, { word: "Tandborste", theme: "Hemmet üè†" },
        { word: "Filt", theme: "Hemmet üè†" }, { word: "Gardiner", theme: "Hemmet üè†" },
        { word: "Lampa", theme: "Hemmet üè†" }, { word: "Matta", theme: "Hemmet üè†" },
        { word: "Bord", theme: "Hemmet üè†" }, { word: "Soffa", theme: "Hemmet üè†" },
        { word: "Spegel", theme: "Hemmet üè†" }, { word: "Frys", theme: "Hemmet üè†" },
        { word: "Spis", theme: "Hemmet üè†" }, { word: "Soptunna", theme: "Hemmet üè†" },
        { word: "Gaffel", theme: "Hemmet üè†" }, { word: "Tallrik", theme: "Hemmet üè†" },
        { word: "Vattenkokare", theme: "Hemmet üè†" }, { word: "Papperskorg", theme: "Hemmet üè†" },

        // üéí Skola/Arbete
        { word: "Penna", theme: "Skola/Arbete üéí" }, { word: "Blyerts", theme: "Skola/Arbete üéí" },
        { word: "Linjal", theme: "Skola/Arbete üéí" }, { word: "Minir√§knare", theme: "Skola/Arbete üéí" },
        { word: "Skrivbok", theme: "Skola/Arbete üéí" }, { word: "P√§rm", theme: "Skola/Arbete üéí" },
        { word: "Datorvagn", theme: "Skola/Arbete üéí" }, { word: "L√§rare", theme: "Skola/Arbete üéí" },
        { word: "Klasskompis", theme: "Skola/Arbete üéí" }, { word: "Schema", theme: "Skola/Arbete üéí" },
        { word: "Kalender", theme: "Skola/Arbete üéí" }, { word: "Projektor", theme: "Skola/Arbete üéí" },
        { word: "Whiteboard", theme: "Skola/Arbete üéí" }, { word: "Prov", theme: "Skola/Arbete üéí" },
        { word: "Uppgift", theme: "Skola/Arbete üéí" }, { word: "B√§nk", theme: "Skola/Arbete üéí" },
        { word: "Sk√•p", theme: "Skola/Arbete üéí" }, { word: "Namnbricka", theme: "Skola/Arbete üéí" },
        { word: "Sax", theme: "Skola/Arbete üéí" },

        // üéâ Fest & N√∂je
        { word: "Fyrverkeri", theme: "Fest & N√∂je üéâ" }, { word: "Ballong", theme: "Fest & N√∂je üéâ" },
        { word: "Present", theme: "Fest & N√∂je üéâ" }, { word: "T√•rta", theme: "Fest & N√∂je üéâ" },
        { word: "Diskoboll", theme: "Fest & N√∂je üéâ" }, { word: "Karaoke", theme: "Fest & N√∂je üéâ" },
        { word: "Spelkort", theme: "Fest & N√∂je üéâ" }, { word: "T√§rning", theme: "Fest & N√∂je üéâ" },
        { word: "Popcorn", theme: "Fest & N√∂je üéâ" }, { word: "Bio", theme: "Fest & N√∂je üéâ" },
        { word: "Dansgolv", theme: "Fest & N√∂je üéâ" }, { word: "DJ", theme: "Fest & N√∂je üéâ" },
        { word: "Glowstick", theme: "Fest & N√∂je üéâ" }, { word: "Partyhatt", theme: "Fest & N√∂je üéâ" },
        { word: "Bowling", theme: "Fest & N√∂je üéâ" }, { word: "Biljard", theme: "Fest & N√∂je üéâ" },
        { word: "Arkadmaskin", theme: "Fest & N√∂je üéâ" }, { word: "Chipsk√•l", theme: "Fest & N√∂je üéâ" },
        { word: "Konfetti", theme: "Fest & N√∂je üéâ" }, { word: "Drink", theme: "Fest & N√∂je üéâ" },

        // üåç Natur
        { word: "Regn", theme: "Natur üåç" }, { word: "Sol", theme: "Natur üåç" },
        { word: "Vind", theme: "Natur üåç" }, { word: "Sn√∂", theme: "Natur üåç" },
        { word: "Blixt", theme: "Natur üåç" }, { word: "Storm", theme: "Natur üåç" },
        { word: "Tr√§d", theme: "Natur üåç" }, { word: "Blommor", theme: "Natur üåç" },
        { word: "Buske", theme: "Natur üåç" }, { word: "Flod", theme: "Natur üåç" },
        { word: "Sj√∂", theme: "Natur üåç" }, { word: "Berg", theme: "Natur üåç" },
        { word: "Kulle", theme: "Natur üåç" }, { word: "Gran", theme: "Natur üåç" },
        { word: "Gr√§s", theme: "Natur üåç" }, { word: "Sand", theme: "Natur üåç" },
        { word: "Moln", theme: "Natur üåç" }, { word: "Vulkan", theme: "Natur üåç" },
        { word: "M√•ne", theme: "Natur üåç" }, { word: "Stj√§rna", theme: "Natur üåç" },

        // üß± Byggnad & Stad
        { word: "Gatuskylt", theme: "Byggnad & Stad üß±" }, { word: "V√§gbro", theme: "Byggnad & Stad üß±" },
        { word: "Rondell", theme: "Byggnad & Stad üß±" }, { word: "Skyskrapa", theme: "Byggnad & Stad üß±" },
        { word: "Garage", theme: "Byggnad & Stad üß±" }, { word: "Trappa", theme: "Byggnad & Stad üß±" },
        { word: "Hiss", theme: "Byggnad & Stad üß±" }, { word: "Elcentral", theme: "Byggnad & Stad üß±" },
        { word: "Staket", theme: "Byggnad & Stad üß±" }, { word: "Kiosk", theme: "Byggnad & Stad üß±" },
        { word: "Tunnel", theme: "Byggnad & Stad üß±" }, { word: "Font√§n", theme: "Byggnad & Stad üß±" },
        { word: "Parkb√§nk", theme: "Byggnad & Stad üß±" }, { word: "Ljusskylt", theme: "Byggnad & Stad üß±" },
        { word: "T√•gstation", theme: "Byggnad & Stad üß±" }, { word: "Flygterminal", theme: "Byggnad & Stad üß±" },
        { word: "Hamn", theme: "Byggnad & Stad üß±" }, { word: "Busskur", theme: "Byggnad & Stad üß±" },
        { word: "Idrottshall", theme: "Byggnad & Stad üß±" }, { word: "Bibliotek", theme: "Byggnad & Stad üß±" },

        // ‚öîÔ∏è Spel & Action
        { word: "Joystick", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Headset", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Konsol", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Level", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Boss", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Sk√∂ld", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Sv√§rd", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Pilb√•ge", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Hj√§lte", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Fiende", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Portal", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Trof√©", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "HP (liv)", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Mana", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Spawn", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Loot", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Arena", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Sniper", theme: "Spel & Action ‚öîÔ∏è" },
        { word: "Team", theme: "Spel & Action ‚öîÔ∏è" }, { word: "Radar", theme: "Spel & Action ‚öîÔ∏è" },

        // üß≥ Resor
        { word: "Pass", theme: "Resor üß≥" }, { word: "Bagage", theme: "Resor üß≥" },
        { word: "Bagageband", theme: "Resor üß≥" }, { word: "Hotellrum", theme: "Resor üß≥" },
        { word: "Guidning", theme: "Resor üß≥" }, { word: "Turist", theme: "Resor üß≥" },
        { word: "Kartbok", theme: "Resor üß≥" }, { word: "Resv√§ska", theme: "Resor üß≥" },
        { word: "Biljett", theme: "Resor üß≥" }, { word: "Solstol", theme: "Resor üß≥" },
        { word: "Utflykt", theme: "Resor üß≥" }, { word: "Reception", theme: "Resor üß≥" },
        { word: "Flygstol", theme: "Resor üß≥" }, { word: "Terminal", theme: "Resor üß≥" },
        { word: "Taxi", theme: "Resor üß≥" }, { word: "Motorv√§g", theme: "Resor üß≥" },
        { word: "Natt√•g", theme: "Resor üß≥" }, { word: "Vandrarhem", theme: "Resor üß≥" },
        { word: "F√§rjel√§ge", theme: "Resor üß≥" }, { word: "Bagagevagn", theme: "Resor üß≥" }
    ];

    // --- STATE VARIABLES ---
    let players = []; // { name: "X", isImposter: false, isOut: false, id: timestamp }
    let currentWordObj = {};
    let useTheme = false;
    let imposterCount = 1;
    let roleIndex = 0; // F√∂r rollvisning
    let voteIndex = 0; // F√∂r r√∂stning
    let votes = {}; // { "playerID": count }
    let activeVoters = []; // Lista p√• spelare som ska r√∂sta

    // --- DOM ELEMENT ---
    const views = {
        setup: document.getElementById('view-setup'),
        pass: document.getElementById('view-pass'),
        reveal: document.getElementById('view-reveal'),
        game: document.getElementById('view-game'),
        votePass: document.getElementById('view-vote-pass'),
        voteInput: document.getElementById('view-vote-input'),
        votePreResult: document.getElementById('view-vote-pre-result'),
        voteResult: document.getElementById('view-vote-result'),
        end: document.getElementById('view-end')
    };

    // --- FUNKTIONER: SETUP ---

    function handleEnter(e) {
        if(e.key === "Enter") addPlayer();
    }

    function addPlayer() {
        const input = document.getElementById('player-name');
        const name = input.value.trim();
        if (!name) return;
        
        if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
            document.getElementById('setup-error').innerText = "Namnet finns redan!";
            return;
        }

        players.push({
            id: Date.now() + Math.random(),
            name: name,
            isImposter: false,
            isOut: false
        });
        
        input.value = "";
        document.getElementById('setup-error').innerText = "";
        renderSetupList();
    }

    function removePlayer(id) {
        players = players.filter(p => p.id !== id);
        renderSetupList();
    }

    function renderSetupList() {
        const list = document.getElementById('player-list');
        list.innerHTML = "";
        players.forEach(p => {
            const li = document.createElement('li');
            li.innerHTML = `<span>${p.name}</span> <button class="delete-btn" onclick="removePlayer(${p.id})">√ó</button>`;
            list.appendChild(li);
        });
    }

    function startGame() {
        const errEl = document.getElementById('setup-error');
        const countInput = document.getElementById('imposter-count');
        imposterCount = parseInt(countInput.value);
        useTheme = document.getElementById('use-theme-toggle').checked;

        if (players.length < 3) {
            errEl.innerText = "Ni m√•ste vara minst 3 spelare.";
            return;
        }
        if (imposterCount < 1 || imposterCount >= players.length) {
            errEl.innerText = `Antal imposters m√•ste vara mellan 1 och ${players.length - 1}.`;
            return;
        }

        // Nollst√§ll state
        votes = {};
        roleIndex = 0;
        
        // 1. V√§lj ord
        currentWordObj = wordData[Math.floor(Math.random() * wordData.length)];

        // 2. Slumpa roller
        // √Öterst√§ll status
        players.forEach(p => { p.isImposter = false; p.isOut = false; });
        
        // Blanda en array av index
        let indices = players.map((_, i) => i);
        for (let i = indices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [indices[i], indices[j]] = [indices[j], indices[i]];
        }

        // S√§tt imposters
        for (let i = 0; i < imposterCount; i++) {
            players[indices[i]].isImposter = true;
        }

        // Starta visning
        updateRolePassScreen();
        showView('pass');
    }

    function showView(viewName) {
        Object.values(views).forEach(el => el.classList.add('hidden'));
        views[viewName].classList.remove('hidden');
    }

    // --- FUNKTIONER: ROLLVISNING ---

    function updateRolePassScreen() {
        const p = players[roleIndex];
        document.getElementById('pass-player-name').innerText = p.name;
    }

    function revealRole() {
        const player = players[roleIndex];
        const container = document.getElementById('role-card-content');
        
        let html = "";

        if (player.isImposter) {
            html += `<div class="imposter-title">DU √ÑR IMPOSTER</div>`;
            html += `<p class="mt-4">Du vet inte ordet!</p>`;
            html += `<p>F√∂rs√∂k lista ut vad de andra pratar om och bluffa.</p>`;
            
            if (useTheme) {
                html += `<p class="mt-4 text-accent bold">TEMA: ${currentWordObj.theme}</p>`;
            }

            // Visa andra imposters
            if (imposterCount > 1) {
                const others = players.filter(p => p.isImposter && p.name !== player.name).map(p => p.name);
                html += `<div class="mt-4 p-2" style="background:rgba(200,0,0,0.2); border-radius:4px;">`;
                html += `<small>DIN MEDBEDRAGARE √ÑR:</small><br><strong>${others.join(", ")}</strong>`;
                html += `</div>`;
            }

        } else {
            html += `<h3 class="text-accent">Du √§r vanlig spelare</h3>`;
            html += `<p>Ditt hemliga ord √§r:</p>`;
            html += `<div class="big-word">${currentWordObj.word}</div>`;
            if (useTheme) {
                html += `<p class="text-secondary">Tema: ${currentWordObj.theme}</p>`;
            }
        }

        container.innerHTML = html;
        showView('reveal');
    }

    function nextRole() {
        roleIndex++;
        if (roleIndex < players.length) {
            updateRolePassScreen();
            showView('pass');
        } else {
            startMainGame();
        }
    }

    // --- FUNKTIONER: SPELRUNDA ---

    function startMainGame() {
        const list = document.getElementById('game-player-list');
        list.innerHTML = "";
        players.forEach(p => {
            if(!p.isOut) {
                const li = document.createElement('li');
                li.innerHTML = `<span class="bold">${p.name}</span>`;
                list.appendChild(li);
            }
        });
        showView('game');
    }

    // --- FUNKTIONER: R√ñSTNING ---

    function initVoting() {
        votes = {};
        // Filtrera fram de som √§r kvar i spelet
        activeVoters = players.filter(p => !p.isOut);
        voteIndex = 0;
        
        if (activeVoters.length === 0) {
            alert("Inga spelare kvar? N√•got gick fel.");
            return;
        }
        
        updateVotePassScreen();
        showView('votePass');
    }

    function updateVotePassScreen() {
        document.getElementById('vote-pass-name').innerText = activeVoters[voteIndex].name;
    }

    function showVoteInput() {
        const currentUser = activeVoters[voteIndex];
        const container = document.getElementById('vote-buttons-container');
        container.innerHTML = "";

        // Man f√•r r√∂sta p√• alla som inte √§r "out" (√§ven sig sj√§lv √§r tekniskt m√∂jligt, men vi listar alla levande)
        const targets = players.filter(p => !p.isOut);

        targets.forEach(target => {
            const btn = document.createElement('button');
            btn.className = "btn-vote";
            btn.innerText = `R√∂sta p√•: ${target.name}`;
            btn.onclick = () => castVote(target.id);
            container.appendChild(btn);
        });

        showView('voteInput');
    }

    function castVote(targetId) {
        if (!votes[targetId]) votes[targetId] = 0;
        votes[targetId]++;
        
        voteIndex++;
        if (voteIndex < activeVoters.length) {
            updateVotePassScreen();
            showView('votePass');
        } else {
            // Alla har r√∂stat - Visa Pre-Result sk√§rm
            prepareVoteResult();
        }
    }

    function prepareVoteResult() {
        showView('votePreResult');
        // √Öterst√§ll UI i pre-result
        document.getElementById('btn-show-vote-res').classList.remove('hidden');
        document.getElementById('vote-timer-container').classList.add('hidden');
    }

    function startVoteCountdown() {
        document.getElementById('btn-show-vote-res').classList.add('hidden');
        document.getElementById('vote-timer-container').classList.remove('hidden');
        
        let count = 5;
        const timerEl = document.getElementById('vote-timer');
        timerEl.innerText = count;

        const interval = setInterval(() => {
            count--;
            if (count > 0) {
                timerEl.innerText = count;
            } else {
                clearInterval(interval);
                calculateVoteResult();
            }
        }, 1000);
    }

    function calculateVoteResult() {
        let maxVotes = 0;
        let candidates = []; // IDn p√• de med flest r√∂ster

        for (const [pid, count] of Object.entries(votes)) {
            if (count > maxVotes) {
                maxVotes = count;
                candidates = [pid];
            } else if (count === maxVotes) {
                candidates.push(pid);
            }
        }

        const resultText = document.getElementById('vote-result-text');
        const actions = document.getElementById('vote-actions');

        if (maxVotes === 0) {
             resultText.innerText = "Ingen r√∂stade.";
        } else if (candidates.length > 1) {
            // Oavgjort
            resultText.innerHTML = `Det blev oavgjort (${maxVotes} r√∂ster var).<br>Ingen √•ker ut denna runda.`;
        } else {
            // N√•gon √•ker ut
            const victimId = candidates[0];
            const victim = players.find(p => p.id == victimId);
            
            if (victim) {
                victim.isOut = true;
                resultText.innerHTML = `<strong style="color:var(--error-color)">${victim.name}</strong> har f√•tt flest r√∂ster (${maxVotes} st) och √§r ute ur spelet.`;
            }
        }

        showView('voteResult');
    }

    function continueGame() {
        startMainGame(); // Uppdaterar listan utan den utr√∂stade
    }

    // --- FUNKTIONER: SLUTSPEL & FACIT ---

    function endGameSequence() {
        showView('end');
        document.getElementById('countdown-container').classList.remove('hidden');
        document.getElementById('final-reveal').classList.add('hidden');
        
        let count = 3;
        const timerEl = document.getElementById('countdown-timer');
        timerEl.innerText = count;

        const interval = setInterval(() => {
            count--;
            if (count > 0) {
                timerEl.innerText = count;
            } else {
                clearInterval(interval);
                showFinalReveal();
            }
        }, 1000);
    }

    function showFinalReveal() {
        document.getElementById('countdown-container').classList.add('hidden');
        document.getElementById('final-reveal').classList.remove('hidden');

        // S√§tt data
        document.getElementById('final-word').innerText = currentWordObj.word;
        document.getElementById('final-theme').innerText = useTheme ? `Tema: ${currentWordObj.theme}` : "";

        const imposterNames = players.filter(p => p.isImposter).map(p => p.name);
        const innocentNames = players.filter(p => !p.isImposter).map(p => p.name);

        const impList = document.getElementById('final-imposters-list');
        impList.innerHTML = "";
        imposterNames.forEach(name => {
            const div = document.createElement('div');
            div.innerText = name;
            impList.appendChild(div);
        });

        document.getElementById('final-innocents-list').innerText = innocentNames.join(", ");

        // Kolla om n√•gon imposter √∂verlevde (!isOut)
        const anyImposterAlive = players.some(p => p.isImposter && !p.isOut);
        const winWrapper = document.getElementById('imposter-win-wrapper');
        
        if (anyImposterAlive) {
            // Imposters vann!
            winWrapper.classList.remove('hidden');
            triggerConfetti();
        } else {
            winWrapper.classList.add('hidden');
        }
    }

    function resetToSetup() {
        stopConfetti();
        showView('setup');
    }

    // --- KONFETTI LOGIK (Inbyggd enkel canvas-version) ---
    let confettiActive = false;
    let animationId = null;
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function triggerConfetti() {
        confettiActive = true;
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        particles = [];
        for(let i=0; i<150; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                size: Math.random() * 5 + 2,
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 2 - 1
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        if (!confettiActive) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            return;
        }
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
            
            p.y += p.speedY;
            p.x += p.speedX;

            if (p.y > canvas.height) p.y = -10;
        });

        animationId = requestAnimationFrame(animateConfetti);
    }

    function stopConfetti() {
        confettiActive = false;
        cancelAnimationFrame(animationId);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Resize handler f√∂r canvas
    window.addEventListener('resize', () => {
        if(confettiActive) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
    });

</script>

</body>
</html>